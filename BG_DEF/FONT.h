// sprites.h
#ifndef SPRITES_H
#define SPRITES_H

// this file is autogenerated - see tga_tools.pl

#include "../palettetools.h"
#include "../lighting.h"

// palette for normal map calculations
RgbPalette rgbSprites = {
    { {1, 1, 1}, {1, 255, 1}, {129, 129, 129}, {155, 155, 155}, {181, 181, 181}, {207, 207, 207}, {233, 233, 233}, {249, 249, 249}, 
      {255, 255, 255}, {99, 105, 169}, {201, 137, 93}, {71, 141, 91}, {103, 35, 45}, {237, 29, 37}, {241, 255, 1}, {0, 0, 0}, 
      {255, 10, 10}, {255, 194, 10}, {133, 255, 10}, {10, 255, 71}, {10, 255, 255}, {10, 71, 255}, {133, 10, 255}, {255, 10, 194}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {1, 1, 1}, {27, 27, 27}, {255, 255, 255}, {63, 73, 205}, {241, 255, 1}, 
      {1, 1, 1}, {161, 25, 99}, {213, 77, 153}, {235, 121, 185}, {255, 175, 201}, {40, 130, 200}, {153, 217, 234}, {199, 235, 245}, 
      {205, 205, 205}, {215, 206, 203}, {231, 227, 223}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {1, 1, 1}, {11, 11, 11}, 
      {87, 87, 87}, {129, 129, 129}, {145, 145, 145}, {155, 155, 155}, {181, 181, 181}, {207, 207, 207}, {233, 233, 233}, {239, 239, 239}, 
      {249, 249, 249}, {255, 255, 255}, {223, 125, 27}, {249, 163, 27}, {235, 189, 21}, {255, 245, 141}, {249, 179, 183}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {137, 125, 119}, {195, 195, 195}, {201, 197, 193}, {217, 215, 213}, 
      {255, 255, 255}, {0, 0, 0}, {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {195, 195, 195}, {255, 255, 255}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {137, 125, 119}, {195, 195, 195}, {241, 217, 175}, {243, 209, 159}, 
      {255, 255, 255}, {1, 203, 255}, {63, 73, 205}, {153, 217, 235}, {253, 179, 1}, {255, 243, 1}, {237, 29, 37}, {255, 201, 15}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {134, 118, 137}, {195, 195, 195}, {201, 192, 201}, {217, 213, 217}, 
      {255, 255, 255}, {41, 35, 30}, {253, 150, 57}, {118, 78, 50}, {144, 133, 132}, {72, 22, 79}, {252, 245, 163}, {211, 1, 1}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {129, 137, 118}, {195, 195, 195}, {192, 241, 175}, {182, 243, 158}, 
      {255, 255, 255}, {244, 246, 59}, {240, 101, 35}, {169, 39, 100}, {252, 252, 229}, {245, 181, 150}, {249, 197, 59}, {196, 45, 52}, 
      {1, 1, 1}, {237, 137, 171}, {241, 189, 207}, {127, 127, 127}, {19, 19, 19}, {195, 195, 195}, {65, 65, 65}, {0, 0, 0}, 
      {71, 65, 63}, {1, 1, 1}, {255, 255, 255}, {63, 73, 205}, {1, 163, 233}, {5, 183, 255}, {1, 203, 255}, {153, 217, 235}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {118, 137, 129}, {195, 195, 195}, {175, 241, 233}, {158, 243, 231}, 
      {255, 255, 255}, {255, 103, 53}, {253, 179, 1}, {255, 201, 15}, {255, 205, 1}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {136, 137, 118}, {195, 195, 195}, {199, 201, 192}, {216, 217, 213}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {118, 131, 137}, {195, 195, 195}, {175, 200, 241}, {158, 192, 243}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {137, 118, 121}, {195, 195, 195}, {201, 192, 192}, {217, 213, 213}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {119, 118, 137}, {195, 195, 195}, {200, 175, 241}, {188, 158, 243}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {1, 1, 1}, {255, 125, 169}, {255, 175, 201}, {127, 127, 127}, {124, 118, 137}, {195, 195, 195}, {197, 192, 201}, {215, 213, 217}, 
      {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {129, 255, 129}, {239, 191, 129}, {239, 65, 129}, {127, 1, 129}, {17, 65, 129}, 
      {17, 191, 129}, {89, 195, 231}, {167, 195, 231}, {205, 127, 231}, {167, 61, 231}, {89, 61, 231}, {51, 129, 231}, {83, 153, 249}, 
      {129, 179, 249}, {173, 153, 249}, {173, 103, 249}, {127, 77, 249}, {83, 103, 249}, {83, 153, 249}, {127, 127, 255} }
};

// buffer palette for writing to CRAM (populated at runtime)
RgbBuff bufferSprites = {
    { 0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0, 0, 
      0, 0, 0, 0, 0, 0, 0 }
};

// palette for calculating color and lighting - hue, saturation, luminance (populated at runtime)
HslPalette hslSprites = {
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, 
      {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} }
};

// palette ranges - used with the palette group collection.
PaletteRange p_rangeSprites   = { 0, 254 };     // all colors
PaletteRange p_rangeFont      = { 2, 6 };       // font
PaletteRange p_rangeLogo      = { 16, 23 };     // logo
PaletteRange p_rangeMenu1     = { 29, 29 };     // menu
PaletteRange p_rangeMenu2     = { 30, 30 };
PaletteRange p_rangeMenu3     = { 31, 31 };
PaletteRange p_rangePpoppy1   = { 33, 36 };     // pixel poppy
PaletteRange p_rangePpoppy2   = { 37, 39 };
PaletteRange p_rangePpoppy3   = { 40, 43 };
PaletteRange p_rangeMacchi1   = { 65, 66 };     // macchi
PaletteRange p_rangeMacchi2   = { 68, 71 };
PaletteRange p_rangeJelly1    = { 81, 82 };     // jelly
PaletteRange p_rangeJelly2    = { 84, 87 };
PaletteRange p_rangePenny1    = { 97, 98 };     //penny
PaletteRange p_rangePenny2    = { 100, 103 };
PaletteRange p_rangePotter1   = { 113, 114 };   // potter
PaletteRange p_rangePotter2   = { 116, 119 };
PaletteRange p_rangeSparta1   = { 113, 114 };   // sparta
PaletteRange p_rangeSparta2   = { 116, 119 };
PaletteRange p_rangePoppy1    = { 145, 146 };   // poppy
PaletteRange p_rangePoppy2    = { 148, 151 };
PaletteRange p_rangeTj1       = { 161, 162 };   // tj
PaletteRange p_rangeTj2       = { 164, 167 };
PaletteRange p_rangeGeorge1   = { 177, 178 };   // george
PaletteRange p_rangeGeorge2   = { 180, 183 };
PaletteRange p_rangeWuppy1    = { 193, 194 };   // wuppy
PaletteRange p_rangeWuppy2    = { 196, 199 };
PaletteRange p_rangeStadler1  = { 209, 215 };   // stadler
PaletteRange p_rangeGarfield1 = { 225, 231 };   // garfield
PaletteRange p_rangeBomb      = { 89, 91 };     // bomb
PaletteRange p_rangeFish      = { 153, 156 };   // fish
PaletteRange p_rangeNormalMap = { 235, 254 };   // normal map

// tracks the accumulation of changes for the HSL color model
GlobalHSL hsl_incSprites = {0, 0, 0};

// initial image setup: hue, saturation, luminance, x_pos, y_pos, x_scale, y_scale, x_scroll (rate), y_scroll (rate), min_sat_id, max_sat_id, min_lum_id, max_lum_id
ImageAttr attrSprites = { 0, 0, 0, toFIXED(0.0), toFIXED(0.0), toFIXED(0.0), toFIXED(0.0), 0, 0, 0, 0}; // default attributes (for single color image)

PaletteRange *paletteRangeSprites[] = {
    &p_rangeSprites0,  // Index 0
    &p_rangeSprites1,  // Index 1
    &p_rangeSprites2,  // Index 2
    &p_rangeSprites3,  // Index 3
    &p_rangeSprites4,  // Index 4
    &p_rangeSprites5,  // Index 5
    &p_rangeSprites6,  // Index 6
    &p_rangeSprites7,  // Index 7
    &p_rangeSprites8,  // Index 8
    &p_rangeSprites9,  // Index 9
    &p_rangeSprites10,  // Index 10
    &p_rangeSprites11,  // Index 11
    &p_rangeSprites12,  // Index 12
    &p_rangeSprites13,  // Index 13
    &p_rangeSprites14,  // Index 14
    &p_rangeSprites15,  // Index 15
    &p_rangeSprites16,  // Index 16
    &p_rangeSprites17,  // Index 17
    &p_rangeSprites18,  // Index 18
    &p_rangeSprites19,  // Index 19
    &p_rangeSprites20,  // Index 20
    &p_rangeSprites21,  // Index 21
    &p_rangeSprites22,  // Index 22
    &p_rangeSprites23,  // Index 23
    &p_rangeSprites24,  // Index 24
    &p_rangeSprites25,  // Index 25
    &p_rangeSprites26,  // Index 26
    &p_rangeSprites27,  // Index 27
    &p_rangeSprites28,  // Index 28
    &p_rangeSprites29,  // Index 29
    &p_rangeSprites30,  // Index 30
    &p_rangeSprites31   // Index 31
};

Uint8 paletteGroups = 32;

Uint8 sprites_spr_id;

static jo_palette sprites_palette;

// Helper Functions

jo_palette	*my_sprites_palette_handling(void)
{
    jo_create_palette(&sprites_palette);
    return (&sprites_palette);
}

void init_sprites_img(void) {
    jo_set_tga_palette_handling(my_sprites_palette_handling);
    sprites_spr_id = jo_sprite_add_tga(JO_ROOT_DIR, "SPRITES.TGA", 255);
    MultiRgbToHsl(&hslSprites, &rgbSprites, &p_rangeSprites0);
    min_max_sl_id(&hslSprites, &p_rangeSprites0, &attrSprites0);
}

void update_sprites_color(void) {
    MultiPalette2Buffer(&bufferSprites, &hslSprites, &hsl_incSprites0, &p_rangeSprites);
}

void update_sprites_palette(void) {
    UpdatePaletteFromBuffer(&bufferSprites, &sprites_palette, &p_rangeSprites);
}

void reset_sprites (void) {
    MultiRgbToHsl(&hslSprites, &rgbSprites, &p_rangeSprites0);
    min_max_sl_id(&hslSprites, &p_rangeSprites0, &attrSprites0);
    MultiPalette2Buffer(&bufferSprites, &hslSprites, &hsl_incSprites0, &p_rangeSprites0);
}

#endif // SPRITES_H
